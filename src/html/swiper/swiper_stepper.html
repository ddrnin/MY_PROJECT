<!DOCTYPE html>
<html lang="en">
<head>
	@@include('../_partials/_head.html', {
		"head_title" : "swiper_stepper"
	})
</head>
<body>
	@@include('../_partials/_header.html', {
		"header_type": "normal",
		"header_title": "swiper_stepper"
	})
	<main class="layoutM">
		<section class="swiper_stepper">
			<div class="dosirak_area">
				<ul class="dosirak">
					<li>밥</li>
					<li>메반1</li>
					<li>메반2</li>
					<li>메반3</li>
					<li>서반1</li>
					<li>서반2</li>
					<li>채김1</li>
					<li>채김2</li>
				</ul>
			</div>
			<div class="swiper stepper_swiper">
				<div class="swiper-wrapper">
					<div class="swiper-slide step01">
						<ul>
							<li>
								<label>
									<input type="checkbox" name="bap" value="">
									<div>밥1</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="bap" value="">
									<div>밥1</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="bap" value="">
									<div>밥1</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="bap" value="">
									<div>밥1</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="bap" value="">
									<div>밥1</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="bap" value="">
									<div>밥1</div>
								</label>
							</li>
						</ul>
					</div>
					<div class="swiper-slide step02">
						<ul>
							<li>
								<label>
									<input type="checkbox" name="meban" value="">
									<div>메인반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="meban" value="">
									<div>메인반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="meban" value="">
									<div>메인반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="meban" value="">
									<div>메인반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="meban" value="">
									<div>메인반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="meban" value="">
									<div>메인반찬</div>
								</label>
							</li>
						</ul>
					</div>
					<div class="swiper-slide step03">
						<ul>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>서브반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>서브반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>서브반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>서브반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>서브반찬</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>서브반찬</div>
								</label>
							</li>
						</ul>
					</div>
					<div class="swiper-slide step04">
						<ul>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>채소/김치</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>채소/김치</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>채소/김치</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>채소/김치</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>채소/김치</div>
								</label>
							</li>
							<li>
								<label>
									<input type="checkbox" name="suban" value="">
									<div>채소/김치</div>
								</label>
							</li>
						</ul>
					</div>
					<div class="swiper-slide step05">
						<div>완성</div>
					</div>
				</div>
				<div class="swiper-button-next"></div>
				<div class="swiper-button-prev"></div>
				<div class="swiper-pagination"></div>
			</div>
		</section>
	</main>
</body>
<script>
	var swiper = new Swiper(".stepper_swiper", {
		touchRatio: 0,
		navigation: {
			nextEl: '.swiper-button-next',
			prevEl: '.swiper-button-prev',
		},
		pagination: {
			el: ".swiper-pagination",
			type: 'bullets',
		},
		on: {
			slideChange: function () {
				// 현재 활성화된 인덱스 가져오기
				var activeIndex = swiper.activeIndex;
				var previousIndex = swiper.previousIndex;
				// 모든 bullet 가져오기
				var bullets = document.querySelectorAll('.swiper-pagination-bullet');

				// 현재 인덱스 이전의 모든 bullet에 active 클래스 추가
				if (activeIndex > previousIndex) {
					bullets.forEach(function (bullet, index) {
						if (index <= activeIndex) {
							bullet.classList.add('active');
						}
					});
				}
				// 뒤로 이동한 경우, 현재 인덱스 이후의 모든 bullet에서 active 클래스 제거
				if (activeIndex < previousIndex) {
					bullets.forEach(function (bullet, index) {
						if (index > activeIndex) {
							bullet.classList.remove('active');
						}
					});
				}
			}
		},
	});

	// function activeButton() {
	// 	// step01
	// 	if($('.swiper-pagination-bullet:nth-child(1)').hasClass('swiper-pagination-bullet-active')){
	// 		$('.swiper-button-next').removeClass('on');
	// 		if ($('.step01 input[type="checkbox"]:checked').length > 0) {
	// 			$('.step01 input[type="checkbox"]').not(':checked').attr('disabled', true);
	// 			$('.swiper-button-next').addClass('on');
	// 		} else {
	// 			$('.step01 input[type="checkbox"]').removeAttr('disabled');
	// 		}
	// 	}
	// 	// step02
	// 	if($('.swiper-pagination-bullet:nth-child(2)').hasClass('swiper-pagination-bullet-active')){
	// 		$('.swiper-button-next').removeClass('on');
	// 		if ($('.step02 input[type="checkbox"]:checked').length >= 3) {
	// 			$('.step02 input[type="checkbox"]').not(':checked').attr('disabled', true);
	// 			$('.swiper-button-next').addClass('on');
	// 		} else {
	// 			$('.step02 input[type="checkbox"]').removeAttr('disabled');
	// 		}
	// 	} 
	// 	// step03
	// 	if($('.swiper-pagination-bullet:nth-child(3)').hasClass('swiper-pagination-bullet-active')){
	// 		$('.swiper-button-next').removeClass('on');
	// 		if ($('.step03 input[type="checkbox"]:checked').length >= 2) {
	// 			$('.step03 input[type="checkbox"]').not(':checked').attr('disabled', true);
	// 			$('.swiper-button-next').addClass('on');
	// 		} else {
	// 			$('.step03 input[type="checkbox"]').removeAttr('disabled');
	// 		}
	// 	} 
	// 	// step04
	// 	if($('.swiper-pagination-bullet:nth-child(4)').hasClass('swiper-pagination-bullet-active')){
	// 		$('.swiper-button-next').removeClass('on');
	// 		if ($('.step04 input[type="checkbox"]:checked').length >= 2) {
	// 			$('.step04 input[type="checkbox"]').not(':checked').attr('disabled', true);
	// 			$('.swiper-button-next').addClass('on');
	// 		} else {
	// 			$('.step04 input[type="checkbox"]').removeAttr('disabled');
	// 		}
	// 	} 

	// }
	// $('.step01').on('change', 'input[type="checkbox"]', activeButton(i))
	// $('.step02').on('change', 'input[type="checkbox"]', activeButton)
	// $('.step03').on('change', 'input[type="checkbox"]', activeButton)
	// $('.step04').on('change', 'input[type="checkbox"]', activeButton)
	// $('.swiper-button-next, .swiper-button-prev').on('click', activeButton)
	
	// step별 체크 갯수
	const minChecked = {
		1: 1,
		2: 3,
		3: 2,
		4: 2
	}

	function activeButton(step) {

		if ($(`.swiper-pagination-bullet:nth-child(${step})`).hasClass('swiper-pagination-bullet-active')) {
			$('.swiper-button-next').removeClass('on');

			const stepSelector = `.step0${step}`;
			const checkedLength = $(`${stepSelector} input[type="checkbox"]:checked`).length;
			if (checkedLength >= minChecked[step]) {
				$(`${stepSelector} input[type="checkbox"]`).not(':checked').attr('disabled', true);
				$('.swiper-button-next').addClass('on');
			} else {
				$(`${stepSelector} input[type="checkbox"]`).removeAttr('disabled');
			}
		} 
	}

	function toastPop(step) {
		// 스텝이 맞는 토스트팝 함수 만들고 넥스트 버튼 눌렀을때 페이지네이션 active로 페이지 판별해서 띄우기
	}

	// 스텝별 checkbox 변화에 따라 갱신
	for (let i = 1; i <= 4; i++) {
		$(`.step0${i}`).on('change', 'input[type="checkbox"]', function() {
			activeButton(i);
		});
	}
	// swiper 버튼 클릭 시 상태 갱신
	$('.swiper-button-next, .swiper-button-prev').on('click', function() {
		for (let i = 1; i <= 4; i++) {
			activeButton(i);
		}
	});






	// 이전 버튼 클릭 시 다음 버튼 활성화
	// $('.swiper-button-prev').on('click', function() {
	// 	$('.swiper-button-next').removeClass('off');
	// });
	//  // 다음 버튼 클릭 시 다음 버튼 비활성화
	// $('.swiper-button-next').on('click', function() {
	// 	$(this).addClass('off')
	// });
	// 스텝02 체크박스 갯수 제한
	// $('.step02').on('change', 'input[type="checkbox"]', function() {
	// 	if ($('.step02 input[type="checkbox"]:checked').length >= 3) {
	// 		$('.step02 input[type="checkbox"]').not(':checked').attr('disabled', true);
	// 		// 선택 갯수 충족 시 다음 버튼 활성화
	// 		$('.swiper-button-next').removeClass('off');
	// 	} else {
	// 		$('.step02 input[type="checkbox"]').removeAttr('disabled');
	// 		$('.swiper-button-next').addClass('off');
	// 	}
	// });
	// 스텝03 체크박스 갯수 제한
	// $('.step03').on('change', 'input[type="checkbox"]', function() {
	// 	if ($('.step03 input[type="checkbox"]:checked').length >= 2) {
	// 		$('.step03 input[type="checkbox"]').not(':checked').attr('disabled', true);
	// 		$('.swiper-button-next').removeClass('off');
	// 	} else {
	// 		$('.step03 input[type="checkbox"]').removeAttr('disabled');
	// 		$('.swiper-button-next').addClass('off');
	// 	}
	// });
	// 스텝04 체크박스 갯수 제한
	// $('.step04').on('change', 'input[type="checkbox"]', function() {
	// 	if ($('.step04 input[type="checkbox"]:checked').length >= 2) {
	// 		$('.step04 input[type="checkbox"]').not(':checked').attr('disabled', true);
	// 		$('.swiper-button-next').removeClass('off');
	// 	} else {
	// 		$('.step04 input[type="checkbox"]').removeAttr('disabled');
	// 		$('.swiper-button-next').addClass('off');
	// 	}
	// });
</script>
</html>